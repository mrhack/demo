<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title> pencil to the world </title>
  <style type="text/css">
  .lottory{
    height: 330px;
    width: 330px;
    overflow: hidden;
  }
  .lottory-item{
    width: 78px;
    height: 100%;
    position: relative;
  }
  .lottory-item .lottory-list{
    position: absolute;
    width: 100%;
    top: -100px;
  }

  ul,li{
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .lottory li{
    background: black;
    width: 100px;
    height: 100px;
    margin: 5px;
    float: left;
  }
  .lottory li.active{
    background: red;
  }
  </style>
 </head>
 <body>
    <ul class="lottory">
    </ul>
    <audio controls style="display:none;">
      <source src="./res/1.ogg" type="audio/ogg">
      <source src="./res/1.mp3" type="audio/mpeg">
    </audio>
    <script type="text/javascript" src="../../lib/jquery/jquery-1.8.3.min.js"></script>
    <script type="text/javascript">
    var lottory = (function( ){
        // init lottory
        !!(function(){
            var prizes = [{
                name: '水杯',
                src: '.../1.png'
            },{
                name: '水杯',
                src: '.../1.png'
            },{
                name: '水杯',
                src: '.../1.png'
            },{
                name: '水杯',
                src: '.../1.png'
            },{
                name: '是在',
                src: '.../1.png'
            },{
                name: '你好',
                src: '.../1.png'
            },{
                name: '小心',
                src: '.../1.png'
            }];
            
            // create dom
            var aHtml = [];
            var index = 0;
            var prize;
            var realPrize = [];
            var startBtn = '<li class="start-btn"></li>';
            var empty = '<li><img src="" alt=""/></li>';
            for (var i = 8; i >= 1; i--) {
                index = ~~(Math.random() * i);
                if( index >= prizes.length ){
                    aHtml.push(empty);
                } else {
                    aHtml.push('<li><img src="' + prizes[index].src  + '" alt="' + prizes[index].name + '"/></li>');
                    prizes.splice( index , 1);
                }
            };
            aHtml.splice( ~~( aHtml.length / 2 ) , 0 , startBtn );
            $('.lottory').html( aHtml.join('') );
        })();
        
        var num = 105;
        var map = [0,1,2,5,8,7,6,3];
        var time = 600;
        var index = 0;
        var status = 0;
        var timer = null;
        var $lis = $('.lottory li');
        var $audio = $('audio');
        function playSound(){
            var $tmp = $audio.clone();
            $(document.body).append($tmp);
            $tmp[0].play();
            setTimeout(function(){
                $tmp.remove();
            } , 1000);
        }
        function loop( callback ){
            timer = setTimeout(function(){
                $lis.removeClass('active')
                    .eq( map[ index % map.length ] )
                    .addClass('active');

                playSound();

                if( status == 0 && index >= num - 30 ){
                    status = 1;
                } else if( status == 1 && index == num ){
                    status = 2;
                }
                switch( status ){
                    case 0:
                        time = Math.max( time / 1.2 , 40);
                        loop( callback );
                    break;
                    case 1:
                        time = Math.min( 1000 , time * 1.1 );
                        loop( callback );
                    break;
                    case 2:
                        callback && callback();
                    break;
                }

                index++;
            } , time);
        }
        return {
            start: function( name, callback ){
                time = 600;
                index = 0;
                status = 0;
                // get number
                var indexTmp = $('.lottory').find('img[alt="' + name +'"]')
                    .closest('li')
                    .index();
                num = 104 + $.inArray(indexTmp , map);

                loop( callback );
                return this;
            },
            pause: function(){
                clearInterval( timer );
                return this;
            },
            reset: function(){
                clearInterval( timer );
                time = 600;
                index = 0;
                status = 0;
                $lis.removeClass('active');
                return this;
            }
        }
    })();
    
    lottory.start('' ,function(){

    });
    </script>
 </body>
</html>